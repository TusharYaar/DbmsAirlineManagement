use flightdatabase;

Create table userinfo(
userid varchar(5) primary key unique, 
pass varchar(100) not null,
first_name varchar(20) not null,
last_name varchar(20) not null,
email varchar(40) not null,
phone bigint(10) not null,
passport_number varchar(10) not null,
dob date not null, 
usertype varchar(5),
occupation varchar(12) not null,
constraint CK_TYPE1 check(usertype IN('user','admin','crew')),
constraint Email_Check check (email like ('%@%.%'))
);



create table airport (
airport_id varchar(5) primary key unique ,
airport_name varchar(35),
airport_city varchar(35),
airport_state varchar(35));

CREATE TABLE flight(
flight_number varchar(5) PRIMARY KEY unique,
departure varchar(7),
departure_date date,
departure_time TIME,
destination varchar(7),
arrival_date date,
arrival_time TIME,
price int(7),
constraint fk_departure foreign key(departure) references airport(airport_id),
constraint fk_destination foreign key(destination) references airport(airport_id)
);



select flight_number,departure_date,departure_time,arrival_date,arrival_time,
ap_des.airport_name as des_name, ap_des.airport_state as des_state, ap_des.airport_city as des_city,
ap_dep.airport_name as dep_name, ap_dep.airport_state as dep_state, ap_dep.airport_city as dep_city
from flight 
join airport as ap_des on flight.departure = ap_des.airport_id 
join airport as ap_dep on flight.destination = ap_dep.airport_id
;



create table flightcrew (
flight_number varchar(5),
crew_id varchar(5),
constraint fk_flight_no foreign key(flight_number) references flight(flight_number),
constraint fk_crew_id foreign key (crew_id) references userinfo(userid) 
)


CREATE TABLE bookedflight(
ticket_number varchar(8) primary key,
userid varchar(5),
flight_number varchar (5),
username varchar(50),
seat_number int(3),
constraint fk_userid foreign key(userid) references userinfo(userid),
constraint fk_flight_number foreign key(flight_number) references flight(flight_number)
);



select ticket_number, userid, bookedflight.flight_number, username, seat_number, departure_date,departure_time,arrival_date,arrival_time,
ap_des.airport_name as des_name, ap_des.airport_state as des_state, ap_des.airport_city as des_city,
ap_dep.airport_name as dep_name, ap_dep.airport_state as dep_state, ap_dep.airport_city as dep_city from bookedflight join flight on bookedflight.flight_number = flight.flight_number
join airport as ap_des on flight.departure = ap_des.airport_id 
join airport as ap_dep on flight.destination = ap_dep.airport_id
where userid = 'U5'; 


select * from flightcrew
JOIN flight ON flightcrew.flight_number = flight.flight_number 
where crew_id = 'U2'



select * from userinfo 
join bookedflight on bookedflight.userid = userinfo.userid 
join flight on bookedflight.flight_number = flight.flight_number
where bookedflight.flight_number = 'F3'